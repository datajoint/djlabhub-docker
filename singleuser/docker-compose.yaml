version: '3.7'
services:
  singleuser:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - JUPYTERHUB_VERSION
    image: datajoint/djlabhub:singleuser-${JUPYTERHUB_VERSION}
    container_name: djlabhub-singleuser
    env_file: .env
    # see https://github.com/moby/moby/issues/14288#issuecomment-1424015361
    network_mode: host
    # ports:
    #   - '46000-47000:46000-47000'
    #   - $GP_RESPONSE_PORT:$GP_RESPONSE_PORT
    #   - $JUPYTER_SERVER_APP_PORT:$JUPYTER_SERVER_APP_PORT
    environment:
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - AWS_DEFAULT_REGION
    volumes:
      - ./config/before_start_hook.sh:/usr/local/bin/before-notebook.d/before_start_hook.sh
      - ./config/jupyter_server_config.py:/etc/jupyter/jupyter_server_config.py
      - ./config/jupyter_jupyterlab_server_config.py:/etc/jupyter/jupyter_jupyterlab_server_config.py
    command:
      - 'start-notebook.py'
      - '--log-level=10'
  djlab:
    extends: singleuser
    container_name: djlab
    image: datajoint/djlab:inherit-hub-${JUPYTERHUB_VERSION}
